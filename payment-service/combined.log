{"level":"info","message":"Service de paiement démarré sur le port 3003"}
{"level":"info","message":"Connecté à MongoDB"}
{"level":"info","message":"Service de paiement démarré sur le port 3003"}
{"code":"ESERVFAIL","hostname":"cluster0.zfkt3sa.mongodb.net","level":"error","message":"Erreur de connexion à MongoDB: queryTxt ESERVFAIL cluster0.zfkt3sa.mongodb.net","stack":"Error: queryTxt ESERVFAIL cluster0.zfkt3sa.mongodb.net\n    at QueryReqWrap.onresolve [as oncomplete] (node:internal/dns/promises:293:17)","syscall":"queryTxt"}
{"level":"info","message":"Service de paiement démarré sur le port 3003"}
{"level":"info","message":"Connecté à MongoDB"}
{"level":"info","message":"Service de paiement démarré sur le port 3005"}
{"level":"info","message":"Connecté à MongoDB"}
{"level":"info","message":"Service de paiement démarré sur le port 3005"}
{"level":"info","message":"Connecté à MongoDB"}
{"level":"info","message":"Service de paiement démarré sur le port 3005"}
{"level":"info","message":"Connecté à MongoDB"}
{"level":"error","message":"Erreur de vérification du token: invalid signature","name":"JsonWebTokenError","stack":"JsonWebTokenError: invalid signature\n    at C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\jsonwebtoken\\verify.js:171:19\n    at getSecret (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\jsonwebtoken\\verify.js:97:14)\n    at module.exports [as verify] (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\jsonwebtoken\\verify.js:101:10)\n    at authenticateToken (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\src\\middlewares\\auth.middleware.js:15:25)\n    at Layer.handle [as handle_request] (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\express\\lib\\router\\index.js:175:3)","timestamp":"2025-08-19T17:22:35.104Z"}
{"level":"info","message":"Service de paiement démarré sur le port 3005"}
{"level":"info","message":"Connecté à MongoDB"}
{"level":"error","message":"Erreur lors de la récupération du client: Stripe: Argument \"customer\" must be a string, but got: undefined (on API request to `GET /v1/customers/{customer}`)","stack":"Error: Stripe: Argument \"customer\" must be a string, but got: undefined (on API request to `GET /v1/customers/{customer}`)\n    at C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\stripe\\cjs\\StripeResource.js:99:23\n    at Array.reduce (<anonymous>)\n    at Constructor._getRequestOpts (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\stripe\\cjs\\StripeResource.js:96:35)\n    at C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\stripe\\cjs\\StripeResource.js:143:29\n    at new Promise (<anonymous>)\n    at Constructor._makeRequest (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\stripe\\cjs\\StripeResource.js:139:16)\n    at Constructor.retrieve (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\stripe\\cjs\\StripeMethod.js:31:83)\n    at StripeService.getCustomer (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\src\\services\\stripe.service.js:105:47)\n    at createPaymentIntent (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\src\\controllers\\payment.controller.js:13:42)\n    at Layer.handle [as handle_request] (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\express\\lib\\router\\layer.js:95:5)","timestamp":"2025-08-19T17:29:19.863Z"}
{"level":"error","message":"Erreur lors de la création de l'intention de paiement: Stripe: Argument \"customer\" must be a string, but got: undefined (on API request to `GET /v1/customers/{customer}`)","stack":"Error: Stripe: Argument \"customer\" must be a string, but got: undefined (on API request to `GET /v1/customers/{customer}`)\n    at C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\stripe\\cjs\\StripeResource.js:99:23\n    at Array.reduce (<anonymous>)\n    at Constructor._getRequestOpts (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\stripe\\cjs\\StripeResource.js:96:35)\n    at C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\stripe\\cjs\\StripeResource.js:143:29\n    at new Promise (<anonymous>)\n    at Constructor._makeRequest (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\stripe\\cjs\\StripeResource.js:139:16)\n    at Constructor.retrieve (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\stripe\\cjs\\StripeMethod.js:31:83)\n    at StripeService.getCustomer (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\src\\services\\stripe.service.js:105:47)\n    at createPaymentIntent (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\src\\controllers\\payment.controller.js:13:42)\n    at Layer.handle [as handle_request] (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\express\\lib\\router\\layer.js:95:5)","timestamp":"2025-08-19T17:29:19.864Z"}
{"level":"info","message":"Service de paiement démarré sur le port 3005"}
{"level":"info","message":"Connecté à MongoDB"}
{"level":"warn","message":"Impossible de mettre à jour stripeCustomerId:","timestamp":"2025-08-19T17:32:50.141Z"}
{"level":"info","message":"Service de paiement démarré sur le port 3005"}
{"level":"info","message":"Connecté à MongoDB"}
{"expiredAt":"2025-08-19T19:44:03.000Z","level":"error","message":"Erreur de vérification du token: jwt expired","name":"TokenExpiredError","stack":"TokenExpiredError: jwt expired\n    at C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\jsonwebtoken\\verify.js:190:21\n    at getSecret (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\jsonwebtoken\\verify.js:97:14)\n    at module.exports [as verify] (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\jsonwebtoken\\verify.js:101:10)\n    at authenticateToken (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\src\\middlewares\\auth.middleware.js:15:25)\n    at Layer.handle [as handle_request] (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\express\\lib\\router\\index.js:175:3)","timestamp":"2025-08-20T04:25:48.572Z"}
{"level":"info","message":"Service de paiement démarré sur le port 3005"}
{"level":"info","message":"Connecté à MongoDB"}
{"level":"warn","message":"Impossible de mettre à jour stripeCustomerId:","timestamp":"2025-08-20T04:26:45.756Z"}
{"level":"info","message":"Service de paiement démarré sur le port 3005"}
{"level":"info","message":"Connecté à MongoDB"}
{"level":"warn","message":"Impossible de mettre à jour stripeCustomerId:","timestamp":"2025-08-20T04:32:16.559Z"}
{"level":"info","message":"Service de paiement démarré sur le port 3005"}
{"level":"info","message":"Connecté à MongoDB"}
{"level":"warn","message":"Impossible de mettre à jour stripeCustomerId:","timestamp":"2025-08-20T04:41:58.545Z"}
{"level":"info","message":"Service de paiement démarré sur le port 3005"}
{"level":"info","message":"Connecté à MongoDB"}
{"level":"warn","message":"Impossible de mettre à jour stripeCustomerId:","timestamp":"2025-08-20T04:52:33.728Z"}
{"level":"info","message":"Service de paiement démarré sur le port 3005"}
{"level":"info","message":"Connecté à MongoDB"}
{"level":"warn","message":"Impossible de mettre à jour stripeCustomerId:","timestamp":"2025-08-20T05:25:40.710Z"}
{"level":"info","message":"Service de paiement démarré sur le port 3005"}
{"level":"error","message":"Erreur de connexion à MongoDB: connect ECONNREFUSED ::1:27017","reason":{"commonWireVersion":0,"compatible":true,"heartbeatFrequencyMS":10000,"localThresholdMS":15,"logicalSessionTimeoutMinutes":null,"maxElectionId":null,"maxSetVersion":null,"servers":{},"setName":null,"stale":false,"type":"Unknown"},"stack":"MongooseServerSelectionError: connect ECONNREFUSED ::1:27017\n    at _handleConnectionErrors (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\mongoose\\lib\\connection.js:816:11)\n    at NativeConnection.openUri (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\mongoose\\lib\\connection.js:791:11)"}
{"level":"error","message":"Erreur de vérification du token: invalid signature","name":"JsonWebTokenError","stack":"JsonWebTokenError: invalid signature\n    at C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\jsonwebtoken\\verify.js:171:19\n    at getSecret (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\jsonwebtoken\\verify.js:97:14)\n    at module.exports [as verify] (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\jsonwebtoken\\verify.js:101:10)\n    at authenticateToken (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\src\\middlewares\\auth.middleware.js:15:25)\n    at Layer.handle [as handle_request] (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\express\\lib\\router\\index.js:175:3)","timestamp":"2025-08-20T15:14:38.411Z"}
{"level":"info","message":"Service de paiement démarré sur le port 3005"}
{"level":"error","message":"Erreur de connexion à MongoDB: connect ECONNREFUSED ::1:27017","reason":{"commonWireVersion":0,"compatible":true,"heartbeatFrequencyMS":10000,"localThresholdMS":15,"logicalSessionTimeoutMinutes":null,"maxElectionId":null,"maxSetVersion":null,"servers":{},"setName":null,"stale":false,"type":"Unknown"},"stack":"MongooseServerSelectionError: connect ECONNREFUSED ::1:27017\n    at _handleConnectionErrors (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\mongoose\\lib\\connection.js:816:11)\n    at NativeConnection.openUri (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\mongoose\\lib\\connection.js:791:11)"}
{"level":"error","message":"Erreur de vérification du token: invalid signature","name":"JsonWebTokenError","stack":"JsonWebTokenError: invalid signature\n    at C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\jsonwebtoken\\verify.js:171:19\n    at getSecret (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\jsonwebtoken\\verify.js:97:14)\n    at module.exports [as verify] (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\jsonwebtoken\\verify.js:101:10)\n    at authenticateToken (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\src\\middlewares\\auth.middleware.js:15:25)\n    at Layer.handle [as handle_request] (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\express\\lib\\router\\index.js:175:3)","timestamp":"2025-08-20T15:22:27.308Z"}
{"level":"info","message":"Service de paiement démarré sur le port 3005"}
{"level":"error","message":"Erreur de connexion à MongoDB: connect ECONNREFUSED ::1:27017","reason":{"commonWireVersion":0,"compatible":true,"heartbeatFrequencyMS":10000,"localThresholdMS":15,"logicalSessionTimeoutMinutes":null,"maxElectionId":null,"maxSetVersion":null,"servers":{},"setName":null,"stale":false,"type":"Unknown"},"stack":"MongooseServerSelectionError: connect ECONNREFUSED ::1:27017\n    at _handleConnectionErrors (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\mongoose\\lib\\connection.js:816:11)\n    at NativeConnection.openUri (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\mongoose\\lib\\connection.js:791:11)"}
{"level":"info","message":"Service de paiement démarré sur le port 3005"}
{"level":"error","message":"Erreur de connexion à MongoDB: connect ECONNREFUSED ::1:27017","reason":{"commonWireVersion":0,"compatible":true,"heartbeatFrequencyMS":10000,"localThresholdMS":15,"logicalSessionTimeoutMinutes":null,"maxElectionId":null,"maxSetVersion":null,"servers":{},"setName":null,"stale":false,"type":"Unknown"},"stack":"MongooseServerSelectionError: connect ECONNREFUSED ::1:27017\n    at _handleConnectionErrors (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\mongoose\\lib\\connection.js:816:11)\n    at NativeConnection.openUri (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\mongoose\\lib\\connection.js:791:11)"}
{"level":"error","message":"Erreur de vérification du token: invalid signature","name":"JsonWebTokenError","stack":"JsonWebTokenError: invalid signature\n    at C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\jsonwebtoken\\verify.js:171:19\n    at getSecret (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\jsonwebtoken\\verify.js:97:14)\n    at module.exports [as verify] (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\jsonwebtoken\\verify.js:101:10)\n    at authenticateToken (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\src\\middlewares\\auth.middleware.js:15:25)\n    at Layer.handle [as handle_request] (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\express\\lib\\router\\index.js:175:3)","timestamp":"2025-08-20T15:26:46.042Z"}
{"level":"info","message":"Service de paiement démarré sur le port 3005"}
{"level":"error","message":"Erreur de connexion à MongoDB: connect ECONNREFUSED ::1:27017","reason":{"commonWireVersion":0,"compatible":true,"heartbeatFrequencyMS":10000,"localThresholdMS":15,"logicalSessionTimeoutMinutes":null,"maxElectionId":null,"maxSetVersion":null,"servers":{},"setName":null,"stale":false,"type":"Unknown"},"stack":"MongooseServerSelectionError: connect ECONNREFUSED ::1:27017\n    at _handleConnectionErrors (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\mongoose\\lib\\connection.js:816:11)\n    at NativeConnection.openUri (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\mongoose\\lib\\connection.js:791:11)"}
{"level":"info","message":"Service de paiement démarré sur le port 3005"}
{"level":"error","message":"Erreur de connexion à MongoDB: connect ECONNREFUSED ::1:27017","reason":{"commonWireVersion":0,"compatible":true,"heartbeatFrequencyMS":10000,"localThresholdMS":15,"logicalSessionTimeoutMinutes":null,"maxElectionId":null,"maxSetVersion":null,"servers":{},"setName":null,"stale":false,"type":"Unknown"},"stack":"MongooseServerSelectionError: connect ECONNREFUSED ::1:27017\n    at _handleConnectionErrors (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\mongoose\\lib\\connection.js:816:11)\n    at NativeConnection.openUri (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\mongoose\\lib\\connection.js:791:11)"}
{"level":"info","message":"Service de paiement démarré sur le port 3005"}
{"level":"error","message":"Erreur de connexion à MongoDB: connect ECONNREFUSED 127.0.0.1:27017","reason":{"commonWireVersion":0,"compatible":true,"heartbeatFrequencyMS":10000,"localThresholdMS":15,"logicalSessionTimeoutMinutes":null,"maxElectionId":null,"maxSetVersion":null,"servers":{},"setName":null,"stale":false,"type":"Unknown"},"stack":"MongooseServerSelectionError: connect ECONNREFUSED 127.0.0.1:27017\n    at _handleConnectionErrors (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\mongoose\\lib\\connection.js:816:11)\n    at NativeConnection.openUri (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\mongoose\\lib\\connection.js:791:11)"}
{"level":"info","message":"Service de paiement démarré sur le port 3005"}
{"level":"info","message":"Connecté à MongoDB"}
{"level":"info","message":"Service de paiement démarré sur le port 3005"}
{"level":"info","message":"Connecté à MongoDB"}
{"headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"342","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=r1JEnLgDWoq2dc-nNWgM6ZKS_RfRtdIDKDLIPbwyXrgbHV5vUTheULuRu1JV35N9jpeTXljdPbNCVnkw","content-type":"application/json","date":"Wed, 20 Aug 2025 15:54:13 GMT","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","vary":"Origin","www-authenticate":"Basic realm=\"Stripe\"","x-robots-tag":"none","x-wc":"ABHIJ"},"level":"error","message":"Erreur lors de la création du client Stripe: You did not provide an API key. You need to provide your API key in the Authorization header, using Bearer auth (e.g. 'Authorization: Bearer YOUR_SECRET_KEY'). See https://stripe.com/docs/api#authentication for details, or we can help at https://support.stripe.com/.","raw":{"headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"342","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=r1JEnLgDWoq2dc-nNWgM6ZKS_RfRtdIDKDLIPbwyXrgbHV5vUTheULuRu1JV35N9jpeTXljdPbNCVnkw","content-type":"application/json","date":"Wed, 20 Aug 2025 15:54:13 GMT","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","vary":"Origin","www-authenticate":"Basic realm=\"Stripe\"","x-robots-tag":"none","x-wc":"ABHIJ"},"message":"You did not provide an API key. You need to provide your API key in the Authorization header, using Bearer auth (e.g. 'Authorization: Bearer YOUR_SECRET_KEY'). See https://stripe.com/docs/api#authentication for details, or we can help at https://support.stripe.com/.","statusCode":401,"type":"invalid_request_error"},"rawType":"invalid_request_error","stack":"Error: You did not provide an API key. You need to provide your API key in the Authorization header, using Bearer auth (e.g. 'Authorization: Bearer YOUR_SECRET_KEY'). See https://stripe.com/docs/api#authentication for details, or we can help at https://support.stripe.com/.\n    at res.toJSON.then.Error_js_1.StripeAPIError.message (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\stripe\\cjs\\RequestSender.js:96:31)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":401,"timestamp":"2025-08-20T15:54:13.355Z","type":"StripeAuthenticationError"}
{"headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"342","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=r1JEnLgDWoq2dc-nNWgM6ZKS_RfRtdIDKDLIPbwyXrgbHV5vUTheULuRu1JV35N9jpeTXljdPbNCVnkw","content-type":"application/json","date":"Wed, 20 Aug 2025 15:54:13 GMT","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","vary":"Origin","www-authenticate":"Basic realm=\"Stripe\"","x-robots-tag":"none","x-wc":"ABHIJ"},"level":"error","message":"Erreur lors de la création de l'intention de paiement: You did not provide an API key. You need to provide your API key in the Authorization header, using Bearer auth (e.g. 'Authorization: Bearer YOUR_SECRET_KEY'). See https://stripe.com/docs/api#authentication for details, or we can help at https://support.stripe.com/.","raw":{"headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"342","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=r1JEnLgDWoq2dc-nNWgM6ZKS_RfRtdIDKDLIPbwyXrgbHV5vUTheULuRu1JV35N9jpeTXljdPbNCVnkw","content-type":"application/json","date":"Wed, 20 Aug 2025 15:54:13 GMT","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","vary":"Origin","www-authenticate":"Basic realm=\"Stripe\"","x-robots-tag":"none","x-wc":"ABHIJ"},"message":"You did not provide an API key. You need to provide your API key in the Authorization header, using Bearer auth (e.g. 'Authorization: Bearer YOUR_SECRET_KEY'). See https://stripe.com/docs/api#authentication for details, or we can help at https://support.stripe.com/.","statusCode":401,"type":"invalid_request_error"},"rawType":"invalid_request_error","stack":"Error: You did not provide an API key. You need to provide your API key in the Authorization header, using Bearer auth (e.g. 'Authorization: Bearer YOUR_SECRET_KEY'). See https://stripe.com/docs/api#authentication for details, or we can help at https://support.stripe.com/.\n    at res.toJSON.then.Error_js_1.StripeAPIError.message (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\stripe\\cjs\\RequestSender.js:96:31)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":401,"timestamp":"2025-08-20T15:54:13.358Z","type":"StripeAuthenticationError"}
{"level":"info","message":"Service de paiement démarré sur le port 3005"}
{"level":"info","message":"Connecté à MongoDB"}
{"level":"warn","message":"Impossible de mettre à jour stripeCustomerId:","timestamp":"2025-08-20T15:58:07.424Z"}
{"level":"warn","message":"Impossible de mettre à jour stripeCustomerId:","timestamp":"2025-08-20T15:59:43.641Z"}
{"level":"info","message":"Service de paiement démarré sur le port 3005"}
{"level":"info","message":"Connecté à MongoDB"}
{"level":"warn","message":"Impossible de mettre à jour stripeCustomerId:","timestamp":"2025-08-20T16:18:46.322Z"}
{"level":"warn","message":"Impossible de mettre à jour stripeCustomerId:","timestamp":"2025-08-20T16:19:50.892Z"}
{"code":"payment_intent_unexpected_state","doc_url":"https://stripe.com/docs/error-codes/payment-intent-unexpected-state","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"2642","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=qULSOQrJLEf4S7sddnNpWX21KLfh-O13NSZ9b9NiMyOqbDU4OvS8CCO2LV6RLSyhPIDXDtkjn7XVUgCP","content-type":"application/json","date":"Wed, 20 Aug 2025 16:19:53 GMT","idempotency-key":"stripe-node-retry-6aa79119-899b-4259-9a21-87a27918a9a3","original-request":"req_8kyXn3CocI90jf","request-id":"req_8kyXn3CocI90jf","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2023-08-16","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"level":"error","message":"Erreur lors de la confirmation du paiement: You cannot confirm this PaymentIntent because it has already succeeded after being previously confirmed.","payment_intent":{"amount":12999,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":12999,"application":null,"application_fee_amount":null,"automatic_payment_methods":{"allow_redirects":"always","enabled":true},"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic","client_secret":"pi_3RyEjrP8JvsmqhfI0kXAJmXa_secret_zEvPQjK92muAYgrPpxb4ocf3E","confirmation_method":"automatic","created":1755706791,"currency":"eur","customer":"cus_Su2pdNK0YrGok1","description":null,"excluded_payment_method_types":null,"id":"pi_3RyEjrP8JvsmqhfI0kXAJmXa","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RyEjrP8JvsmqhfI0VuY0QO5","livemode":false,"metadata":{"courseId":"68a337a84ee5249d628cd688","userId":"687d0e1b06ef3dc75b57204e"},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RyEjrP8JvsmqhfIdhSXqHzG","payment_method_configuration_details":{"id":"pmc_1Rcrg4P8JvsmqhfIXLC1TiZT","parent":null},"payment_method_options":{"bancontact":{"preferred_language":"en"},"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"},"eps":{},"giropay":{},"klarna":{"preferred_locale":null},"link":{"persistent_token":null}},"payment_method_types":["card","bancontact","eps","giropay","klarna","link"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":null,"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null},"raw":{"code":"payment_intent_unexpected_state","doc_url":"https://stripe.com/docs/error-codes/payment-intent-unexpected-state","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"2642","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=qULSOQrJLEf4S7sddnNpWX21KLfh-O13NSZ9b9NiMyOqbDU4OvS8CCO2LV6RLSyhPIDXDtkjn7XVUgCP","content-type":"application/json","date":"Wed, 20 Aug 2025 16:19:53 GMT","idempotency-key":"stripe-node-retry-6aa79119-899b-4259-9a21-87a27918a9a3","original-request":"req_8kyXn3CocI90jf","request-id":"req_8kyXn3CocI90jf","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2023-08-16","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"message":"You cannot confirm this PaymentIntent because it has already succeeded after being previously confirmed.","payment_intent":{"amount":12999,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":12999,"application":null,"application_fee_amount":null,"automatic_payment_methods":{"allow_redirects":"always","enabled":true},"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic","client_secret":"pi_3RyEjrP8JvsmqhfI0kXAJmXa_secret_zEvPQjK92muAYgrPpxb4ocf3E","confirmation_method":"automatic","created":1755706791,"currency":"eur","customer":"cus_Su2pdNK0YrGok1","description":null,"excluded_payment_method_types":null,"id":"pi_3RyEjrP8JvsmqhfI0kXAJmXa","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RyEjrP8JvsmqhfI0VuY0QO5","livemode":false,"metadata":{"courseId":"68a337a84ee5249d628cd688","userId":"687d0e1b06ef3dc75b57204e"},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RyEjrP8JvsmqhfIdhSXqHzG","payment_method_configuration_details":{"id":"pmc_1Rcrg4P8JvsmqhfIXLC1TiZT","parent":null},"payment_method_options":{"bancontact":{"preferred_language":"en"},"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"},"eps":{},"giropay":{},"klarna":{"preferred_locale":null},"link":{"persistent_token":null}},"payment_method_types":["card","bancontact","eps","giropay","klarna","link"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":null,"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null},"requestId":"req_8kyXn3CocI90jf","request_log_url":"https://dashboard.stripe.com/test/logs/req_8kyXn3CocI90jf?t=1755706792","statusCode":400,"type":"invalid_request_error"},"rawType":"invalid_request_error","requestId":"req_8kyXn3CocI90jf","stack":"Error: You cannot confirm this PaymentIntent because it has already succeeded after being previously confirmed.\n    at StripeError.generate (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\stripe\\cjs\\Error.js:10:20)\n    at res.toJSON.then.Error_js_1.StripeAPIError.message (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\stripe\\cjs\\RequestSender.js:105:54)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"timestamp":"2025-08-20T16:19:53.011Z","type":"StripeInvalidRequestError"}
{"code":"payment_intent_unexpected_state","doc_url":"https://stripe.com/docs/error-codes/payment-intent-unexpected-state","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"2642","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=qULSOQrJLEf4S7sddnNpWX21KLfh-O13NSZ9b9NiMyOqbDU4OvS8CCO2LV6RLSyhPIDXDtkjn7XVUgCP","content-type":"application/json","date":"Wed, 20 Aug 2025 16:19:53 GMT","idempotency-key":"stripe-node-retry-6aa79119-899b-4259-9a21-87a27918a9a3","original-request":"req_8kyXn3CocI90jf","request-id":"req_8kyXn3CocI90jf","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2023-08-16","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"level":"error","message":"Erreur lors de la confirmation du paiement: You cannot confirm this PaymentIntent because it has already succeeded after being previously confirmed.","payment_intent":{"amount":12999,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":12999,"application":null,"application_fee_amount":null,"automatic_payment_methods":{"allow_redirects":"always","enabled":true},"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic","client_secret":"pi_3RyEjrP8JvsmqhfI0kXAJmXa_secret_zEvPQjK92muAYgrPpxb4ocf3E","confirmation_method":"automatic","created":1755706791,"currency":"eur","customer":"cus_Su2pdNK0YrGok1","description":null,"excluded_payment_method_types":null,"id":"pi_3RyEjrP8JvsmqhfI0kXAJmXa","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RyEjrP8JvsmqhfI0VuY0QO5","livemode":false,"metadata":{"courseId":"68a337a84ee5249d628cd688","userId":"687d0e1b06ef3dc75b57204e"},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RyEjrP8JvsmqhfIdhSXqHzG","payment_method_configuration_details":{"id":"pmc_1Rcrg4P8JvsmqhfIXLC1TiZT","parent":null},"payment_method_options":{"bancontact":{"preferred_language":"en"},"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"},"eps":{},"giropay":{},"klarna":{"preferred_locale":null},"link":{"persistent_token":null}},"payment_method_types":["card","bancontact","eps","giropay","klarna","link"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":null,"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null},"raw":{"code":"payment_intent_unexpected_state","doc_url":"https://stripe.com/docs/error-codes/payment-intent-unexpected-state","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"2642","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=qULSOQrJLEf4S7sddnNpWX21KLfh-O13NSZ9b9NiMyOqbDU4OvS8CCO2LV6RLSyhPIDXDtkjn7XVUgCP","content-type":"application/json","date":"Wed, 20 Aug 2025 16:19:53 GMT","idempotency-key":"stripe-node-retry-6aa79119-899b-4259-9a21-87a27918a9a3","original-request":"req_8kyXn3CocI90jf","request-id":"req_8kyXn3CocI90jf","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2023-08-16","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"message":"You cannot confirm this PaymentIntent because it has already succeeded after being previously confirmed.","payment_intent":{"amount":12999,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":12999,"application":null,"application_fee_amount":null,"automatic_payment_methods":{"allow_redirects":"always","enabled":true},"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic","client_secret":"pi_3RyEjrP8JvsmqhfI0kXAJmXa_secret_zEvPQjK92muAYgrPpxb4ocf3E","confirmation_method":"automatic","created":1755706791,"currency":"eur","customer":"cus_Su2pdNK0YrGok1","description":null,"excluded_payment_method_types":null,"id":"pi_3RyEjrP8JvsmqhfI0kXAJmXa","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RyEjrP8JvsmqhfI0VuY0QO5","livemode":false,"metadata":{"courseId":"68a337a84ee5249d628cd688","userId":"687d0e1b06ef3dc75b57204e"},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RyEjrP8JvsmqhfIdhSXqHzG","payment_method_configuration_details":{"id":"pmc_1Rcrg4P8JvsmqhfIXLC1TiZT","parent":null},"payment_method_options":{"bancontact":{"preferred_language":"en"},"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"},"eps":{},"giropay":{},"klarna":{"preferred_locale":null},"link":{"persistent_token":null}},"payment_method_types":["card","bancontact","eps","giropay","klarna","link"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":null,"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null},"requestId":"req_8kyXn3CocI90jf","request_log_url":"https://dashboard.stripe.com/test/logs/req_8kyXn3CocI90jf?t=1755706792","statusCode":400,"type":"invalid_request_error"},"rawType":"invalid_request_error","requestId":"req_8kyXn3CocI90jf","stack":"Error: You cannot confirm this PaymentIntent because it has already succeeded after being previously confirmed.\n    at StripeError.generate (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\stripe\\cjs\\Error.js:10:20)\n    at res.toJSON.then.Error_js_1.StripeAPIError.message (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\stripe\\cjs\\RequestSender.js:105:54)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"timestamp":"2025-08-20T16:19:53.016Z","type":"StripeInvalidRequestError"}
{"level":"warn","message":"Impossible de mettre à jour stripeCustomerId:","timestamp":"2025-08-20T16:20:55.908Z"}
{"code":"payment_intent_unexpected_state","doc_url":"https://stripe.com/docs/error-codes/payment-intent-unexpected-state","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"2642","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=qULSOQrJLEf4S7sddnNpWX21KLfh-O13NSZ9b9NiMyOqbDU4OvS8CCO2LV6RLSyhPIDXDtkjn7XVUgCP","content-type":"application/json","date":"Wed, 20 Aug 2025 16:20:58 GMT","idempotency-key":"stripe-node-retry-e7f7f5b0-e094-49e8-b776-e4104c1cece1","original-request":"req_flYcbkWPDuHHxp","request-id":"req_flYcbkWPDuHHxp","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2023-08-16","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"level":"error","message":"Erreur lors de la confirmation du paiement: You cannot confirm this PaymentIntent because it has already succeeded after being previously confirmed.","payment_intent":{"amount":12999,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":12999,"application":null,"application_fee_amount":null,"automatic_payment_methods":{"allow_redirects":"always","enabled":true},"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic","client_secret":"pi_3RyEkuP8JvsmqhfI1qDl04Rw_secret_0VuEzJ51SMFJKxgvVgszStjbh","confirmation_method":"automatic","created":1755706856,"currency":"eur","customer":"cus_Su2qxQqXR4aSsu","description":null,"excluded_payment_method_types":null,"id":"pi_3RyEkuP8JvsmqhfI1qDl04Rw","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RyEkuP8JvsmqhfI1rgXDJ4U","livemode":false,"metadata":{"courseId":"68a337a84ee5249d628cd688","userId":"687d0e1b06ef3dc75b57204e"},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RyEkuP8JvsmqhfIh6kHZtuC","payment_method_configuration_details":{"id":"pmc_1Rcrg4P8JvsmqhfIXLC1TiZT","parent":null},"payment_method_options":{"bancontact":{"preferred_language":"en"},"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"},"eps":{},"giropay":{},"klarna":{"preferred_locale":null},"link":{"persistent_token":null}},"payment_method_types":["card","bancontact","eps","giropay","klarna","link"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":null,"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null},"raw":{"code":"payment_intent_unexpected_state","doc_url":"https://stripe.com/docs/error-codes/payment-intent-unexpected-state","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"2642","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=qULSOQrJLEf4S7sddnNpWX21KLfh-O13NSZ9b9NiMyOqbDU4OvS8CCO2LV6RLSyhPIDXDtkjn7XVUgCP","content-type":"application/json","date":"Wed, 20 Aug 2025 16:20:58 GMT","idempotency-key":"stripe-node-retry-e7f7f5b0-e094-49e8-b776-e4104c1cece1","original-request":"req_flYcbkWPDuHHxp","request-id":"req_flYcbkWPDuHHxp","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2023-08-16","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"message":"You cannot confirm this PaymentIntent because it has already succeeded after being previously confirmed.","payment_intent":{"amount":12999,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":12999,"application":null,"application_fee_amount":null,"automatic_payment_methods":{"allow_redirects":"always","enabled":true},"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic","client_secret":"pi_3RyEkuP8JvsmqhfI1qDl04Rw_secret_0VuEzJ51SMFJKxgvVgszStjbh","confirmation_method":"automatic","created":1755706856,"currency":"eur","customer":"cus_Su2qxQqXR4aSsu","description":null,"excluded_payment_method_types":null,"id":"pi_3RyEkuP8JvsmqhfI1qDl04Rw","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RyEkuP8JvsmqhfI1rgXDJ4U","livemode":false,"metadata":{"courseId":"68a337a84ee5249d628cd688","userId":"687d0e1b06ef3dc75b57204e"},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RyEkuP8JvsmqhfIh6kHZtuC","payment_method_configuration_details":{"id":"pmc_1Rcrg4P8JvsmqhfIXLC1TiZT","parent":null},"payment_method_options":{"bancontact":{"preferred_language":"en"},"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"},"eps":{},"giropay":{},"klarna":{"preferred_locale":null},"link":{"persistent_token":null}},"payment_method_types":["card","bancontact","eps","giropay","klarna","link"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":null,"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null},"requestId":"req_flYcbkWPDuHHxp","request_log_url":"https://dashboard.stripe.com/test/logs/req_flYcbkWPDuHHxp?t=1755706858","statusCode":400,"type":"invalid_request_error"},"rawType":"invalid_request_error","requestId":"req_flYcbkWPDuHHxp","stack":"Error: You cannot confirm this PaymentIntent because it has already succeeded after being previously confirmed.\n    at StripeError.generate (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\stripe\\cjs\\Error.js:10:20)\n    at res.toJSON.then.Error_js_1.StripeAPIError.message (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\stripe\\cjs\\RequestSender.js:105:54)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"timestamp":"2025-08-20T16:20:58.274Z","type":"StripeInvalidRequestError"}
{"code":"payment_intent_unexpected_state","doc_url":"https://stripe.com/docs/error-codes/payment-intent-unexpected-state","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"2642","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=qULSOQrJLEf4S7sddnNpWX21KLfh-O13NSZ9b9NiMyOqbDU4OvS8CCO2LV6RLSyhPIDXDtkjn7XVUgCP","content-type":"application/json","date":"Wed, 20 Aug 2025 16:20:58 GMT","idempotency-key":"stripe-node-retry-e7f7f5b0-e094-49e8-b776-e4104c1cece1","original-request":"req_flYcbkWPDuHHxp","request-id":"req_flYcbkWPDuHHxp","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2023-08-16","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"level":"error","message":"Erreur lors de la confirmation du paiement: You cannot confirm this PaymentIntent because it has already succeeded after being previously confirmed.","payment_intent":{"amount":12999,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":12999,"application":null,"application_fee_amount":null,"automatic_payment_methods":{"allow_redirects":"always","enabled":true},"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic","client_secret":"pi_3RyEkuP8JvsmqhfI1qDl04Rw_secret_0VuEzJ51SMFJKxgvVgszStjbh","confirmation_method":"automatic","created":1755706856,"currency":"eur","customer":"cus_Su2qxQqXR4aSsu","description":null,"excluded_payment_method_types":null,"id":"pi_3RyEkuP8JvsmqhfI1qDl04Rw","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RyEkuP8JvsmqhfI1rgXDJ4U","livemode":false,"metadata":{"courseId":"68a337a84ee5249d628cd688","userId":"687d0e1b06ef3dc75b57204e"},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RyEkuP8JvsmqhfIh6kHZtuC","payment_method_configuration_details":{"id":"pmc_1Rcrg4P8JvsmqhfIXLC1TiZT","parent":null},"payment_method_options":{"bancontact":{"preferred_language":"en"},"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"},"eps":{},"giropay":{},"klarna":{"preferred_locale":null},"link":{"persistent_token":null}},"payment_method_types":["card","bancontact","eps","giropay","klarna","link"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":null,"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null},"raw":{"code":"payment_intent_unexpected_state","doc_url":"https://stripe.com/docs/error-codes/payment-intent-unexpected-state","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"2642","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=qULSOQrJLEf4S7sddnNpWX21KLfh-O13NSZ9b9NiMyOqbDU4OvS8CCO2LV6RLSyhPIDXDtkjn7XVUgCP","content-type":"application/json","date":"Wed, 20 Aug 2025 16:20:58 GMT","idempotency-key":"stripe-node-retry-e7f7f5b0-e094-49e8-b776-e4104c1cece1","original-request":"req_flYcbkWPDuHHxp","request-id":"req_flYcbkWPDuHHxp","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2023-08-16","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"message":"You cannot confirm this PaymentIntent because it has already succeeded after being previously confirmed.","payment_intent":{"amount":12999,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":12999,"application":null,"application_fee_amount":null,"automatic_payment_methods":{"allow_redirects":"always","enabled":true},"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic","client_secret":"pi_3RyEkuP8JvsmqhfI1qDl04Rw_secret_0VuEzJ51SMFJKxgvVgszStjbh","confirmation_method":"automatic","created":1755706856,"currency":"eur","customer":"cus_Su2qxQqXR4aSsu","description":null,"excluded_payment_method_types":null,"id":"pi_3RyEkuP8JvsmqhfI1qDl04Rw","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RyEkuP8JvsmqhfI1rgXDJ4U","livemode":false,"metadata":{"courseId":"68a337a84ee5249d628cd688","userId":"687d0e1b06ef3dc75b57204e"},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RyEkuP8JvsmqhfIh6kHZtuC","payment_method_configuration_details":{"id":"pmc_1Rcrg4P8JvsmqhfIXLC1TiZT","parent":null},"payment_method_options":{"bancontact":{"preferred_language":"en"},"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"},"eps":{},"giropay":{},"klarna":{"preferred_locale":null},"link":{"persistent_token":null}},"payment_method_types":["card","bancontact","eps","giropay","klarna","link"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":null,"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null},"requestId":"req_flYcbkWPDuHHxp","request_log_url":"https://dashboard.stripe.com/test/logs/req_flYcbkWPDuHHxp?t=1755706858","statusCode":400,"type":"invalid_request_error"},"rawType":"invalid_request_error","requestId":"req_flYcbkWPDuHHxp","stack":"Error: You cannot confirm this PaymentIntent because it has already succeeded after being previously confirmed.\n    at StripeError.generate (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\stripe\\cjs\\Error.js:10:20)\n    at res.toJSON.then.Error_js_1.StripeAPIError.message (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\stripe\\cjs\\RequestSender.js:105:54)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"timestamp":"2025-08-20T16:20:58.278Z","type":"StripeInvalidRequestError"}
{"level":"info","message":"Service de paiement démarré sur le port 3005"}
{"level":"info","message":"Connecté à MongoDB"}
{"level":"warn","message":"Impossible de mettre à jour stripeCustomerId:","timestamp":"2025-08-20T16:23:55.311Z"}
{"level":"warn","message":"Impossible de mettre à jour stripeCustomerId:","timestamp":"2025-08-21T01:27:39.394Z"}
{"code":"payment_intent_unexpected_state","doc_url":"https://stripe.com/docs/error-codes/payment-intent-unexpected-state","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"2640","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=OxJXwS4ffJ3PQpF7vo86dxAGekW1VUxnMeUhgAA9kngYJyZ9gBe4A5L2AamZCxhWUxMv73vWuKqwu3aq","content-type":"application/json","date":"Thu, 21 Aug 2025 01:27:41 GMT","idempotency-key":"stripe-node-retry-7c3224eb-de58-4e0c-96b3-86b91a8a1ff8","original-request":"req_JedlQtcrdmPZWy","request-id":"req_JedlQtcrdmPZWy","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2023-08-16","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"level":"error","message":"Erreur lors de la confirmation du paiement: You cannot confirm this PaymentIntent because it has already succeeded after being previously confirmed.","payment_intent":{"amount":4499,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":4499,"application":null,"application_fee_amount":null,"automatic_payment_methods":{"allow_redirects":"always","enabled":true},"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic","client_secret":"pi_3RyNHzP8JvsmqhfI0oFlQLXs_secret_gNGsEe7D8ieuNhMkdcmmpCQE8","confirmation_method":"automatic","created":1755739659,"currency":"eur","customer":"cus_SuBfWbuUiDrlfl","description":null,"excluded_payment_method_types":null,"id":"pi_3RyNHzP8JvsmqhfI0oFlQLXs","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RyNHzP8JvsmqhfI08vRJjkN","livemode":false,"metadata":{"courseId":"68a094d761d9f8cafea6c98f","userId":"687d0e1b06ef3dc75b57204e"},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RyNI0P8JvsmqhfIrGUaFwWD","payment_method_configuration_details":{"id":"pmc_1Rcrg4P8JvsmqhfIXLC1TiZT","parent":null},"payment_method_options":{"bancontact":{"preferred_language":"en"},"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"},"eps":{},"giropay":{},"klarna":{"preferred_locale":null},"link":{"persistent_token":null}},"payment_method_types":["card","bancontact","eps","giropay","klarna","link"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":null,"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null},"raw":{"code":"payment_intent_unexpected_state","doc_url":"https://stripe.com/docs/error-codes/payment-intent-unexpected-state","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"2640","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=OxJXwS4ffJ3PQpF7vo86dxAGekW1VUxnMeUhgAA9kngYJyZ9gBe4A5L2AamZCxhWUxMv73vWuKqwu3aq","content-type":"application/json","date":"Thu, 21 Aug 2025 01:27:41 GMT","idempotency-key":"stripe-node-retry-7c3224eb-de58-4e0c-96b3-86b91a8a1ff8","original-request":"req_JedlQtcrdmPZWy","request-id":"req_JedlQtcrdmPZWy","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2023-08-16","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"message":"You cannot confirm this PaymentIntent because it has already succeeded after being previously confirmed.","payment_intent":{"amount":4499,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":4499,"application":null,"application_fee_amount":null,"automatic_payment_methods":{"allow_redirects":"always","enabled":true},"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic","client_secret":"pi_3RyNHzP8JvsmqhfI0oFlQLXs_secret_gNGsEe7D8ieuNhMkdcmmpCQE8","confirmation_method":"automatic","created":1755739659,"currency":"eur","customer":"cus_SuBfWbuUiDrlfl","description":null,"excluded_payment_method_types":null,"id":"pi_3RyNHzP8JvsmqhfI0oFlQLXs","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RyNHzP8JvsmqhfI08vRJjkN","livemode":false,"metadata":{"courseId":"68a094d761d9f8cafea6c98f","userId":"687d0e1b06ef3dc75b57204e"},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RyNI0P8JvsmqhfIrGUaFwWD","payment_method_configuration_details":{"id":"pmc_1Rcrg4P8JvsmqhfIXLC1TiZT","parent":null},"payment_method_options":{"bancontact":{"preferred_language":"en"},"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"},"eps":{},"giropay":{},"klarna":{"preferred_locale":null},"link":{"persistent_token":null}},"payment_method_types":["card","bancontact","eps","giropay","klarna","link"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":null,"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null},"requestId":"req_JedlQtcrdmPZWy","request_log_url":"https://dashboard.stripe.com/test/logs/req_JedlQtcrdmPZWy?t=1755739661","statusCode":400,"type":"invalid_request_error"},"rawType":"invalid_request_error","requestId":"req_JedlQtcrdmPZWy","stack":"Error: You cannot confirm this PaymentIntent because it has already succeeded after being previously confirmed.\n    at StripeError.generate (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\stripe\\cjs\\Error.js:10:20)\n    at res.toJSON.then.Error_js_1.StripeAPIError.message (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\stripe\\cjs\\RequestSender.js:105:54)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"timestamp":"2025-08-21T01:27:41.719Z","type":"StripeInvalidRequestError"}
{"code":"payment_intent_unexpected_state","doc_url":"https://stripe.com/docs/error-codes/payment-intent-unexpected-state","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"2640","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=OxJXwS4ffJ3PQpF7vo86dxAGekW1VUxnMeUhgAA9kngYJyZ9gBe4A5L2AamZCxhWUxMv73vWuKqwu3aq","content-type":"application/json","date":"Thu, 21 Aug 2025 01:27:41 GMT","idempotency-key":"stripe-node-retry-7c3224eb-de58-4e0c-96b3-86b91a8a1ff8","original-request":"req_JedlQtcrdmPZWy","request-id":"req_JedlQtcrdmPZWy","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2023-08-16","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"level":"error","message":"Erreur lors de la confirmation du paiement: You cannot confirm this PaymentIntent because it has already succeeded after being previously confirmed.","payment_intent":{"amount":4499,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":4499,"application":null,"application_fee_amount":null,"automatic_payment_methods":{"allow_redirects":"always","enabled":true},"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic","client_secret":"pi_3RyNHzP8JvsmqhfI0oFlQLXs_secret_gNGsEe7D8ieuNhMkdcmmpCQE8","confirmation_method":"automatic","created":1755739659,"currency":"eur","customer":"cus_SuBfWbuUiDrlfl","description":null,"excluded_payment_method_types":null,"id":"pi_3RyNHzP8JvsmqhfI0oFlQLXs","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RyNHzP8JvsmqhfI08vRJjkN","livemode":false,"metadata":{"courseId":"68a094d761d9f8cafea6c98f","userId":"687d0e1b06ef3dc75b57204e"},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RyNI0P8JvsmqhfIrGUaFwWD","payment_method_configuration_details":{"id":"pmc_1Rcrg4P8JvsmqhfIXLC1TiZT","parent":null},"payment_method_options":{"bancontact":{"preferred_language":"en"},"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"},"eps":{},"giropay":{},"klarna":{"preferred_locale":null},"link":{"persistent_token":null}},"payment_method_types":["card","bancontact","eps","giropay","klarna","link"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":null,"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null},"raw":{"code":"payment_intent_unexpected_state","doc_url":"https://stripe.com/docs/error-codes/payment-intent-unexpected-state","headers":{"access-control-allow-credentials":"true","access-control-allow-methods":"GET, HEAD, PUT, PATCH, POST, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","connection":"keep-alive","content-length":"2640","content-security-policy":"base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'; worker-src 'none'; upgrade-insecure-requests; report-uri https://q.stripe.com/csp-violation?q=OxJXwS4ffJ3PQpF7vo86dxAGekW1VUxnMeUhgAA9kngYJyZ9gBe4A5L2AamZCxhWUxMv73vWuKqwu3aq","content-type":"application/json","date":"Thu, 21 Aug 2025 01:27:41 GMT","idempotency-key":"stripe-node-retry-7c3224eb-de58-4e0c-96b3-86b91a8a1ff8","original-request":"req_JedlQtcrdmPZWy","request-id":"req_JedlQtcrdmPZWy","server":"nginx","strict-transport-security":"max-age=63072000; includeSubDomains; preload","stripe-version":"2023-08-16","vary":"Origin","x-stripe-priority-routing-enabled":"true","x-stripe-routing-context-priority-tier":"api-testmode","x-wc":"ABGHIJ"},"message":"You cannot confirm this PaymentIntent because it has already succeeded after being previously confirmed.","payment_intent":{"amount":4499,"amount_capturable":0,"amount_details":{"tip":{}},"amount_received":4499,"application":null,"application_fee_amount":null,"automatic_payment_methods":{"allow_redirects":"always","enabled":true},"canceled_at":null,"cancellation_reason":null,"capture_method":"automatic","client_secret":"pi_3RyNHzP8JvsmqhfI0oFlQLXs_secret_gNGsEe7D8ieuNhMkdcmmpCQE8","confirmation_method":"automatic","created":1755739659,"currency":"eur","customer":"cus_SuBfWbuUiDrlfl","description":null,"excluded_payment_method_types":null,"id":"pi_3RyNHzP8JvsmqhfI0oFlQLXs","invoice":null,"last_payment_error":null,"latest_charge":"ch_3RyNHzP8JvsmqhfI08vRJjkN","livemode":false,"metadata":{"courseId":"68a094d761d9f8cafea6c98f","userId":"687d0e1b06ef3dc75b57204e"},"next_action":null,"object":"payment_intent","on_behalf_of":null,"payment_method":"pm_1RyNI0P8JvsmqhfIrGUaFwWD","payment_method_configuration_details":{"id":"pmc_1Rcrg4P8JvsmqhfIXLC1TiZT","parent":null},"payment_method_options":{"bancontact":{"preferred_language":"en"},"card":{"installments":null,"mandate_options":null,"network":null,"request_three_d_secure":"automatic"},"eps":{},"giropay":{},"klarna":{"preferred_locale":null},"link":{"persistent_token":null}},"payment_method_types":["card","bancontact","eps","giropay","klarna","link"],"processing":null,"receipt_email":null,"review":null,"setup_future_usage":null,"shipping":null,"source":null,"statement_descriptor":null,"statement_descriptor_suffix":null,"status":"succeeded","transfer_data":null,"transfer_group":null},"requestId":"req_JedlQtcrdmPZWy","request_log_url":"https://dashboard.stripe.com/test/logs/req_JedlQtcrdmPZWy?t=1755739661","statusCode":400,"type":"invalid_request_error"},"rawType":"invalid_request_error","requestId":"req_JedlQtcrdmPZWy","stack":"Error: You cannot confirm this PaymentIntent because it has already succeeded after being previously confirmed.\n    at StripeError.generate (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\stripe\\cjs\\Error.js:10:20)\n    at res.toJSON.then.Error_js_1.StripeAPIError.message (C:\\Users\\dalid\\workspace\\zakaria\\course-plateform\\payment-service\\node_modules\\stripe\\cjs\\RequestSender.js:105:54)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"timestamp":"2025-08-21T01:27:41.724Z","type":"StripeInvalidRequestError"}
{"level":"info","message":"Service de paiement démarré sur le port 3005"}
{"level":"info","message":"Connecté à MongoDB"}
{"level":"warn","message":"Impossible de mettre à jour stripeCustomerId:","timestamp":"2025-08-21T01:31:07.720Z"}
{"level":"warn","message":"Impossible de mettre à jour stripeCustomerId:","timestamp":"2025-08-21T01:31:40.656Z"}
