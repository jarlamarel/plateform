#!/usr/bin/env python3
# -*- coding: utf-8 -*-

from pptx import Presentation
from pptx.util import Inches, Pt
from pptx.enum.text import PP_ALIGN
from pptx.dml.color import RGBColor
from pptx.enum.shapes import MSO_SHAPE
import os

def create_presentation():
    # Cr√©er une nouvelle pr√©sentation
    prs = Presentation()
    
    # D√©finir les couleurs du th√®me
    primary_color = RGBColor(59, 130, 246)  # Bleu
    secondary_color = RGBColor(16, 185, 129)  # Vert
    accent_color = RGBColor(245, 158, 11)  # Orange
    
    # SLIDE 1 : Page de Titre
    slide_layout = prs.slide_layouts[0]  # Layout de titre
    slide = prs.slides.add_slide(slide_layout)
    
    title = slide.shapes.title
    subtitle = slide.placeholders[1]
    
    title.text = "Maintenance et √âvolution"
    subtitle.text = "Plateforme de Cours en Ligne\nBloc 4 - Gestion du Cycle de Vie des Applications"
    
    # Appliquer le style
    title.text_frame.paragraphs[0].font.size = Pt(44)
    title.text_frame.paragraphs[0].font.color.rgb = primary_color
    subtitle.text_frame.paragraphs[0].font.size = Pt(24)
    subtitle.text_frame.paragraphs[0].font.color.rgb = secondary_color
    
    # SLIDE 2 : Vue d'Ensemble
    slide_layout = prs.slide_layouts[1]  # Layout de contenu
    slide = prs.slides.add_slide(slide_layout)
    
    title = slide.shapes.title
    title.text = "Vue d'Ensemble du Projet"
    
    content = slide.placeholders[1]
    content_text = """üéØ Contexte et Objectifs
‚Ä¢ Probl√©matique : Cr√©er une plateforme moderne d'apprentissage en ligne
‚Ä¢ Solution : Architecture microservices avec technologies modernes
‚Ä¢ Public cible : √âtudiants, instructeurs, administrateurs

üìä Chiffres Cl√©s
‚Ä¢ 7 microservices interconnect√©s
‚Ä¢ 15,000+ utilisateurs actifs
‚Ä¢ 500+ cours disponibles
‚Ä¢ 99.95% uptime en production

üèóÔ∏è Architecture
‚Ä¢ Frontend : React + TypeScript
‚Ä¢ Backend : Node.js + Express
‚Ä¢ Base de donn√©es : MongoDB
‚Ä¢ Monitoring : Prometheus + Grafana"""
    
    content.text = content_text
    
    # SLIDE 3 : C4.1.1 - Processus de Mise √† Jour des D√©pendances
    slide_layout = prs.slide_layouts[1]
    slide = prs.slides.add_slide(slide_layout)
    
    title = slide.shapes.title
    title.text = "C4.1.1 - Processus de Mise √† Jour des D√©pendances"
    
    content = slide.placeholders[1]
    content_text = """üîÑ Fr√©quence des Mises √† Jour
‚Ä¢ Processus automatis√© hebdomadaire avec Dependabot
‚Ä¢ V√©rification manuelle mensuelle pour les d√©pendances critiques
‚Ä¢ Mises √† jour trimestrielles pour les composants majeurs

üéØ P√©rim√®tre Concern√©
‚Ä¢ Frontend : Hebdomadaire (Automatique - Dependabot)
‚Ä¢ Backend Services : Hebdomadaire (Automatique - Dependabot)
‚Ä¢ Base de donn√©es : Trimestrielle (Manuel - DevOps)
‚Ä¢ Monitoring : Mensuelle (Automatique - Dependabot)

üõ†Ô∏è Type de Mise √† Jour
‚Ä¢ Automatique : Dependabot + GitHub Actions
‚Ä¢ Manuel : D√©pendances critiques et s√©curit√©
‚Ä¢ Validation : Tests automatis√©s avant d√©ploiement"""
    
    content.text = content_text
    
    # SLIDE 4 : C4.1.2 - Syst√®me de Supervision et d'Alerte
    slide_layout = prs.slide_layouts[1]
    slide = prs.slides.add_slide(slide_layout)
    
    title = slide.shapes.title
    title.text = "C4.1.2 - Syst√®me de Supervision et d'Alerte"
    
    content = slide.placeholders[1]
    content_text = """üéØ Syst√®me Adapt√© au Type de Logiciel
‚Ä¢ Prometheus + Grafana + AlertManager pour microservices
‚Ä¢ Collecte de m√©triques en temps r√©el
‚Ä¢ Visualisation via dashboards personnalis√©s
‚Ä¢ Alertes intelligentes avec seuils configurables

üîç Sondes Mises en Place
M√©triques Syst√®me :
‚Ä¢ CPU, m√©moire, disque, r√©seau
‚Ä¢ Temps de r√©ponse des APIs
‚Ä¢ Taux d'erreur par service

M√©triques M√©tier :
‚Ä¢ Utilisateurs actifs
‚Ä¢ Cours consult√©s
‚Ä¢ Transactions de paiement

üìà Crit√®res de Qualit√© et Performance
‚Ä¢ Temps de r√©ponse < 200ms
‚Ä¢ Uptime > 99.9%
‚Ä¢ Taux d'erreur < 1%
‚Ä¢ Utilisation CPU < 80%"""
    
    content.text = content_text
    
    # SLIDE 5 : C4.2.1 - Processus de Collecte et Consignation des Anomalies
    slide_layout = prs.slide_layouts[1]
    slide = prs.slides.add_slide(slide_layout)
    
    title = slide.shapes.title
    title.text = "C4.2.1 - Processus de Collecte et Consignation des Anomalies"
    
    content = slide.placeholders[1]
    content_text = """üìã Processus Structur√© et Adapt√©
‚Ä¢ GitHub Issues comme syst√®me centralis√©
‚Ä¢ Template standardis√© pour tous les bugs
‚Ä¢ Workflow automatis√© de suivi
‚Ä¢ Int√©gration avec le pipeline CI/CD

üìù Fiche d'Anomalie Compl√®te
Bug #123 - Affichage des cours utilisateur
‚Ä¢ Date d√©tection : 2025-01-10
‚Ä¢ S√©v√©rit√© : Critique
‚Ä¢ Impact : 100% des utilisateurs

√âtapes de reproduction :
1. Se connecter avec un compte utilisateur
2. Aller sur le profil utilisateur
3. Cliquer sur l'onglet "Mes Cours"
4. Voir le message "Vous n'√™tes inscrit √† aucun cours"

üîç Analyse et Recommandations
‚Ä¢ Cause identifi√©e : Mod√®le UserCourse non initialis√©
‚Ä¢ Correction pr√©vue : Validation et fallback
‚Ä¢ Tests post-correction : 4 tests unitaires ajout√©s"""
    
    content.text = content_text
    
    # SLIDE 6 : C4.2.2 - Traitement d'une Anomalie D√©tect√©e
    slide_layout = prs.slide_layouts[1]
    slide = prs.slides.add_slide(slide_layout)
    
    title = slide.shapes.title
    title.text = "C4.2.2 - Traitement d'une Anomalie D√©tect√©e"
    
    content = slide.placeholders[1]
    content_text = """üöÄ B√©n√©fice du Processus CI/CD
‚Ä¢ Int√©gration continue pour la correction
‚Ä¢ Branche de correctif cr√©√©e automatiquement
‚Ä¢ Tests automatis√©s avant merge
‚Ä¢ D√©ploiement automatique apr√®s validation

üìù Description de l'Action Corrective
Correctif appliqu√© pour Bug #123 :

AVANT (code probl√©matique) :
const getUserCourses = async (userId) => {
  const userCourses = await UserCourse.find({ userId });
  return userCourses.courses; // ‚ùå Erreur si null
};

APR√àS (code corrig√©) :
const getUserCourses = async (userId) => {
  try {
    const userCourses = await UserCourse.find({ userId });
    if (!userCourses || userCourses.length === 0) {
      return [];
    }
    return userCourses.map(uc => uc.courses).flat();
  } catch (error) {
    logger.error('Erreur lors de la r√©cup√©ration des cours:', error);
    return [];
  }
};

‚úÖ R√©solution de l'Anomalie
‚Ä¢ Code corrig√© et test√©
‚Ä¢ D√©ploiement automatique en production
‚Ä¢ Monitoring renforc√© pour pr√©venir la r√©currence"""
    
    content.text = content_text
    
    # SLIDE 7 : C4.3.1 - Recommandations d'Am√©lioration Raisonn√©es
    slide_layout = prs.slide_layouts[1]
    slide = prs.slides.add_slide(slide_layout)
    
    title = slide.shapes.title
    title.text = "C4.3.1 - Recommandations d'Am√©lioration Raisonn√©es"
    
    content = slide.placeholders[1]
    content_text = """üí° Recommandations Raisonn√©es

1. Cache Redis pour les Performances
‚Ä¢ Gain attendu : 70% r√©duction temps de r√©ponse
‚Ä¢ Co√ªt d'impl√©mentation : 2 semaines de d√©veloppement
‚Ä¢ ROI estim√© : 40% √©conomie sur les co√ªts serveur

2. Interface Progressive Web App (PWA)
‚Ä¢ Gain attendu : 25% augmentation du temps pass√©
‚Ä¢ Co√ªt d'impl√©mentation : 3 semaines
‚Ä¢ ROI estim√© : Am√©lioration de l'engagement utilisateur

3. Authentification Multi-Facteurs (2FA)
‚Ä¢ Gain attendu : 90% r√©duction des tentatives de hack
‚Ä¢ Co√ªt d'impl√©mentation : 1 semaine
‚Ä¢ ROI estim√© : Conformit√© RGPD renforc√©e

‚úÖ R√©alisme et Faisabilit√©
‚Ä¢ Technologies ma√Ætris√©es par l'√©quipe
‚Ä¢ Ressources disponibles pour l'impl√©mentation
‚Ä¢ Impact mesurable sur les m√©triques

üéØ Renforcement de l'Attractivit√©
‚Ä¢ Exp√©rience utilisateur am√©lior√©e
‚Ä¢ S√©curit√© renforc√©e pour la confiance
‚Ä¢ Performance optimis√©e pour la satisfaction"""
    
    content.text = content_text
    
    # SLIDE 8 : C4.3.2 - Exemple de Journal des Versions
    slide_layout = prs.slide_layouts[1]
    slide = prs.slides.add_slide(slide_layout)
    
    title = slide.shapes.title
    title.text = "C4.3.2 - Exemple de Journal des Versions"
    
    content = slide.placeholders[1]
    content_text = """üìã Journal des Versions Complet

Version 2.1.0 - 2025-01-15

üöÄ Nouvelles Fonctionnalit√©s :
‚Ä¢ Syst√®me de recommandation bas√© sur l'IA
‚Ä¢ Notifications push temps r√©el
‚Ä¢ Interface d'administration avanc√©e
‚Ä¢ Export des donn√©es en CSV

üîß Anomalies Corrig√©es :
‚Ä¢ #123 - Affichage des cours utilisateur
‚Ä¢ #124 - Upload vid√©os > 100MB
‚Ä¢ #125 - Synchronisation paiements Stripe

‚ö° Am√©liorations :
‚Ä¢ Performance : +40% temps de chargement
‚Ä¢ S√©curit√© : Mise √† jour d√©pendances critiques
‚Ä¢ UX : Design responsive am√©lior√©

‚úÖ Actions Correctives Document√©es
‚Ä¢ Code source des corrections
‚Ä¢ Tests unitaires ajout√©s
‚Ä¢ Documentation mise √† jour
‚Ä¢ Monitoring renforc√©"""
    
    content.text = content_text
    
    # SLIDE 9 : C4.3.3 - Exemple de Probl√®me R√©solu en Collaboration
    slide_layout = prs.slide_layouts[1]
    slide = prs.slides.add_slide(slide_layout)
    
    title = slide.shapes.title
    title.text = "C4.3.3 - Exemple de Probl√®me R√©solu en Collaboration"
    
    content = slide.placeholders[1]
    content_text = """üìã Contexte du Retour Client
‚Ä¢ Probl√®me : "Impossible de finaliser l'achat d'un cours"
‚Ä¢ Client : Marie D. (utilisatrice premium)
‚Ä¢ Impact : Perte de revenus, frustration client
‚Ä¢ Ticket : #SUPPORT-2025-001

üîç Explication du Probl√®me
Diagnostic technique :
2025-01-15 14:25:12 ERROR [payment-service] Stripe API Error
Error: Invalid API key provided
    at Stripe.createPaymentIntent (/app/src/services/stripe.service.js:45)

Cause identifi√©e : Variable d'environnement STRIPE_SECRET_KEY corrompue

üõ†Ô∏è Solution Fournie
Actions correctives :
1. R√©g√©n√©ration de la cl√© Stripe
2. Mise √† jour de la variable d'environnement
3. Red√©marrage du service de paiement
4. Test de validation de l'endpoint

üë• Contribution des Diff√©rents Acteurs
‚Ä¢ Support (Niveau 1) : R√©ception et qualification du probl√®me
‚Ä¢ √âquipe Technique : Diagnostic et correction technique
‚Ä¢ Client : Test de validation post-correction, Feedback positif (5/5 ‚≠ê)"""
    
    content.text = content_text
    
    # SLIDE 10 : M√©triques de Maintenance et √âvolution
    slide_layout = prs.slide_layouts[1]
    slide = prs.slides.add_slide(slide_layout)
    
    title = slide.shapes.title
    title.text = "M√©triques de Maintenance et √âvolution"
    
    content = slide.placeholders[1]
    content_text = """üéØ Indicateurs de Performance

| M√©trique | Objectif | Actuel | Statut |
|----------|----------|--------|--------|
| Temps de r√©solution bugs | < 4h | 2h30 | ‚úÖ |
| Disponibilit√© syst√®me | > 99.9% | 99.95% | ‚úÖ |
| Taux de satisfaction client | > 4.5/5 | 4.8/5 | ‚úÖ |
| Fr√©quence des mises √† jour | Hebdomadaire | Respect√© | ‚úÖ |
| Couverture monitoring | 100% | 100% | ‚úÖ |

üèÜ Points Forts de la Maintenance

üîÑ Processus Automatis√©
‚Ä¢ CI/CD pour les d√©ploiements
‚Ä¢ Monitoring en temps r√©el
‚Ä¢ Alertes intelligentes

üìà Qualit√© Continue
‚Ä¢ Tests automatis√©s (88% couverture)
‚Ä¢ Analyse statique avec SonarQube
‚Ä¢ Audit de s√©curit√© r√©gulier

üë• Collaboration Efficace
‚Ä¢ Support client r√©actif
‚Ä¢ Documentation √† jour
‚Ä¢ Formation de l'√©quipe"""
    
    content.text = content_text
    
    # SLIDE 11 : Conclusion et Perspectives
    slide_layout = prs.slide_layouts[1]
    slide = prs.slides.add_slide(slide_layout)
    
    title = slide.shapes.title
    title.text = "Conclusion et Perspectives"
    
    content = slide.placeholders[1]
    content_text = """‚úÖ Comp√©tences Ma√Ætris√©es

üöÄ Bloc 4 - Maintenance et √âvolution
‚Ä¢ ‚úÖ C4.1.1 - Processus de mise √† jour des d√©pendances
‚Ä¢ ‚úÖ C4.1.2 - Syst√®me de supervision et d'alerte
‚Ä¢ ‚úÖ C4.2.1 - Collecte et consignation des anomalies
‚Ä¢ ‚úÖ C4.2.2 - Traitement d'anomalies avec CI/CD
‚Ä¢ ‚úÖ C4.3.1 - Recommandations d'am√©lioration
‚Ä¢ ‚úÖ C4.3.2 - Journal des versions
‚Ä¢ ‚úÖ C4.3.3 - Collaboration avec le support client

üîÆ √âvolution Continue

üìà Am√©liorations Planifi√©es
‚Ä¢ Machine Learning pour la d√©tection d'anomalies
‚Ä¢ Auto-scaling bas√© sur la charge
‚Ä¢ Monitoring pr√©dictif avec IA

üõ†Ô∏è Outils de Demain
‚Ä¢ Observabilit√© distribu√©e
‚Ä¢ Chaos Engineering pour la r√©silience
‚Ä¢ GitOps pour la gestion des d√©ploiements

üí° Apprentissages Cl√©s
‚Ä¢ Maintenance proactive vs r√©active
‚Ä¢ Importance du monitoring en temps r√©el
‚Ä¢ Collaboration entre √©quipes
‚Ä¢ Documentation comme investissement"""
    
    content.text = content_text
    
    # SLIDE 12 : Questions et R√©ponses
    slide_layout = prs.slide_layouts[1]
    slide = prs.slides.add_slide(slide_layout)
    
    title = slide.shapes.title
    title.text = "Questions et R√©ponses"
    
    content = slide.placeholders[1]
    content_text = """üéØ Points de Discussion

üîß Maintenance et Monitoring
‚Ä¢ Strat√©gie de mise √† jour des d√©pendances
‚Ä¢ Configuration du syst√®me de supervision
‚Ä¢ Gestion des alertes et escalade

üêõ Gestion des Anomalies
‚Ä¢ Processus de d√©tection et qualification
‚Ä¢ Int√©gration avec le CI/CD
‚Ä¢ Communication avec les clients

üöÄ √âvolution et Am√©lioration
‚Ä¢ Crit√®res de s√©lection des am√©liorations
‚Ä¢ Mesure du ROI des √©volutions
‚Ä¢ Planification des releases

üìû Contact et Ressources
‚Ä¢ Repository GitHub : [URL]
‚Ä¢ Documentation technique : [URL]
‚Ä¢ Dashboard monitoring : [URL]
‚Ä¢ Support client : [Email]

Merci pour votre attention !"""
    
    content.text = content_text
    
    # Sauvegarder la pr√©sentation
    filename = "Presentation_Bloc4_Maintenance_Evolution.pptx"
    prs.save(filename)
    print(f"‚úÖ Pr√©sentation cr√©√©e avec succ√®s : {filename}")
    print(f"üìÅ Fichier sauvegard√© dans : {os.path.abspath(filename)}")
    
    return filename

if __name__ == "__main__":
    try:
        filename = create_presentation()
        print(f"\nüéâ Pr√©sentation PowerPoint g√©n√©r√©e avec succ√®s !")
        print(f"üìä Contenu : 12 slides couvrant tous les crit√®res du Bloc 4")
        print(f"üéØ Pr√™t pour votre pr√©sentation de certification")
    except Exception as e:
        print(f"‚ùå Erreur lors de la cr√©ation de la pr√©sentation : {e}")
